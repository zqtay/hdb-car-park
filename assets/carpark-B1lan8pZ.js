(function(){"use strict";class r{static a=6378137;static f=1/298.257223563;static e2=2*r.f-r.f*r.f;static e4=r.e2*r.e2;static e6=r.e4*r.e2;static oLat=1.366666;static oLon=103.833333;static No=38744.572;static Eo=28001.642;static k0=1;static toLatLon(s,n){const{a,e2:t,oLat:c,oLon:i,No:p,Eo:l,k0:e}=r,u=c*Math.PI/180,g=r.calcM(u),C=s-p,E=n-l,F=(g+C/e)/(a*(1-t/4-3*t*t/64-5*t*t*t/256)),o=(1-Math.sqrt(1-t))/(1+Math.sqrt(1-t)),Z=3*o/2-27*o*o*o/32,O=21*o*o/16-55*o*o*o*o/32,W=151*o*o*o/96,w=1097*o*o*o*o/512,k=F+Z*Math.sin(2*F)+O*Math.sin(4*F)+W*Math.sin(6*F)+w*Math.sin(8*F),m=Math.sin(k),d=Math.cos(k),D=Math.tan(k),h=D*D,I=h*h,y=t*d*d/(1-t),L=y*y,z=a/Math.sqrt(1-t*m*m),P=a*(1-t)/Math.pow(1-t*m*m,1.5),f=E/(z*e),A=f*f,J=A*f,N=J*f,j=N*f,x=j*f,B=-(D/(P*e))*(A/2),H=-(D/(P*e))*(N/24)*(5+3*h+10*y-4*L-9*t/(1-t)),K=-(D/(P*e))*(x/720)*(61+90*h+298*y+45*I-252*t/(1-t)-3*L),Q=(k+B+H+K)*180/Math.PI,R=f/d,T=J/6*(1+2*h+y)/d,U=j/120*(5-2*y+28*h-3*L+8*t/(1-t)+24*I)/d,X=i+(R-T+U)*180/Math.PI;return{latitude:Q,longitude:X}}static calcM(s){const{a:n,e2:a,e4:t,e6:c}=r;return n*((1-a/4-3*t/64-5*c/256)*s-(3*a/8+3*t/32+45*c/1024)*Math.sin(2*s)+(15*t/256+45*c/1024)*Math.sin(4*s)-35*c/3072*Math.sin(6*s))}}const q=(M,s)=>{if(!M||!s||s.length<3)return!1;const[n,a]=M;if(typeof n!="number"||typeof a!="number"||!isFinite(n)||!isFinite(a))return!1;let t=!1;const c=s.length;for(let i=0,p=c-1;i<c;p=i++){const[l,e]=s[i],[u,g]=s[p];if(!(!isFinite(l)||!isFinite(e)||!isFinite(u)||!isFinite(g))){if(l===n&&e===a||u===n&&g===a)return!0;l>n!=u>n&&a<(g-e)*(n-l)/(u-l)+e&&(t=!t)}}return t},b={GetAreaCapacity:"GetAreaCapacity",GetZoneCapacity:"GetZoneCapacity"},G=(M,s)=>s?.map(n=>{const a=M.filter(({position:i})=>q(i,n.geometry.coordinates[0].map(([p,l])=>[l,p]))),t=a.reduce((i,p)=>{const l=p.availability?.carpark_info.reduce((e,u)=>e+parseInt(u.lots_available),0)||0;return i+l},0),c=a.reduce((i,p)=>{const l=p.availability?.carpark_info.reduce((e,u)=>e+parseInt(u.total_lots),0)||0;return i+l},0);return{feature:n,lots:{available:t,total:c}}});self.onmessage=M=>{const{data:s,operation:n}=M.data;let a={operation:n};if(n===b.GetAreaCapacity){const{carParkData:t,areaData:c}=s,i=G(t,c);a.data=i}else if(n===b.GetZoneCapacity){const{carParkData:t,zoneData:c}=s,i=G(t,c);a.data=i}self.postMessage(a)}})();
