(function(){"use strict";class r{static a=6378137;static f=1/298.257223563;static e2=2*r.f-r.f*r.f;static e4=r.e2*r.e2;static e6=r.e4*r.e2;static oLat=1.366666;static oLon=103.833333;static No=38744.572;static Eo=28001.642;static k0=1;static toLatLon(n,s){const{a,e2:t,oLat:o,oLon:p,No:f,Eo:e,k0:i}=r,l=o*Math.PI/180,h=r.calcM(l),g=n-f,Z=s-e,m=(h+g/i)/(a*(1-t/4-3*t*t/64-5*t*t*t/256)),c=(1-Math.sqrt(1-t))/(1+Math.sqrt(1-t)),x=3*c/2-27*c*c*c/32,O=21*c*c/16-55*c*c*c*c/32,W=151*c*c*c/96,v=1097*c*c*c*c/512,b=m+x*Math.sin(2*m)+O*Math.sin(4*m)+W*Math.sin(6*m)+v*Math.sin(8*m),k=Math.sin(b),D=Math.cos(b),F=Math.tan(b),y=F*F,I=y*y,d=t*D*D/(1-t),P=d*d,w=a/Math.sqrt(1-t*k*k),L=a*(1-t)/Math.pow(1-t*k*k,1.5),M=Z/(w*i),E=M*M,J=E*M,N=J*M,j=N*M,z=j*M,H=-(F/(L*i))*(E/2),R=-(F/(L*i))*(N/24)*(5+3*y+10*d-4*P-9*t/(1-t)),T=-(F/(L*i))*(z/720)*(61+90*y+298*d+45*I-252*t/(1-t)-3*P),B=(b+H+R+T)*180/Math.PI,K=M/D,Q=J/6*(1+2*y+d)/D,U=j/120*(5-2*d+28*y-3*P+8*t/(1-t)+24*I)/D,X=p+(K-Q+U)*180/Math.PI;return{latitude:B,longitude:X}}static calcM(n){const{a:s,e2:a,e4:t,e6:o}=r;return s*((1-a/4-3*t/64-5*o/256)*n-(3*a/8+3*t/32+45*o/1024)*Math.sin(2*n)+(15*t/256+45*o/1024)*Math.sin(4*n)-35*o/3072*Math.sin(6*n))}}const q=(u,n)=>{if(!u||!n||n.length<3)return!1;const[s,a]=u;if(typeof s!="number"||typeof a!="number"||!isFinite(s)||!isFinite(a))return!1;let t=!1;const o=n.length;for(let p=0,f=o-1;p<o;f=p++){const[e,i]=n[p],[l,h]=n[f];if(!(!isFinite(e)||!isFinite(i)||!isFinite(l)||!isFinite(h))){if(e===s&&i===a||l===s&&h===a)return!0;e>s!=l>s&&a<(h-i)*(s-e)/(l-e)+i&&(t=!t)}}return t},C=u=>{const n=/<th>([^<]+)<\/th>\s*<td>([^<]+)<\/td>/g,s=[...u.matchAll(n)],a={};return s.forEach(([,t,o])=>{a[t]=o}),a},A={GetAreaCapacity:"GetAreaCapacity",GetZoneCapacity:"GetZoneCapacity"},G=(u,n)=>n?.map(s=>{const a=u.filter(({position:e})=>q(e,s.geometry.coordinates[0].map(([i,l])=>[l,i]))),t=a.some(e=>e.availability),o=t?a.reduce((e,i)=>{const l=i.availability?.carpark_info.reduce((h,g)=>h+parseInt(g.lots_available),0)||0;return e+l},0):void 0,p=t?a.reduce((e,i)=>{const l=i.availability?.carpark_info.reduce((h,g)=>h+parseInt(g.total_lots),0)||0;return e+l},0):void 0,f=C(s.properties?.Description||"");return f.carparks=a,{info:f,feature:s,lots:{available:o,total:p}}});self.onmessage=u=>{const{data:n,operation:s}=u.data;let a={operation:s};if(s===A.GetAreaCapacity){const{carParkData:t,areaData:o}=n,p=G(t,o);a.data=p}else if(s===A.GetZoneCapacity){const{carParkData:t,zoneData:o}=n,p=G(t,o);a.data=p}self.postMessage(a)}})();
